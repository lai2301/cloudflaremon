version: '3.8'

services:
  heartbeat-sender:
    image: alpine:latest
    container_name: heartbeat-sender
    restart: unless-stopped
    environment:
      - WORKER_URL=https://heartbeat-monitor.your-subdomain.workers.dev/api/heartbeat
      - SERVICE_ID=service-1
      - API_KEY=your-secret-key-1
      - INTERVAL=120  # seconds between heartbeats
    command: >
      sh -c "
        apk add --no-cache curl &&
        while true; do
          curl -X POST \"$$WORKER_URL\" \
            -H 'Content-Type: application/json' \
            -H \"Authorization: Bearer $$API_KEY\" \
            -d '{\"serviceId\":\"'$$SERVICE_ID'\",\"status\":\"up\",\"message\":\"Heartbeat from Docker\"}' &&
          echo \"[$(date)] Heartbeat sent\" ||
          echo \"[$(date)] Failed to send heartbeat\" ;
          sleep $$INTERVAL ;
        done
      "

